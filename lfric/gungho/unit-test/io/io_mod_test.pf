!-----------------------------------------------------------------------------
! (c) Crown copyright 2018 Met Office. All rights reserved.
! The file LICENCE, distributed with this code, contains details of the terms
! under which the code may be used.
!-----------------------------------------------------------------------------
!> @brief Test the selected functionality of io_mod
!>
!> @details A pFUnit test module to exercise the functionality in io_mod.
!>
module io_mod_test

  use pFUnit_mod

  implicit none

  private
  public :: test_restart_filename

  @TestCase
  type, public, extends(TestCase) :: io_test_type

    private

  contains

    procedure setUp
    procedure tearDown
    procedure test_restart_filename

  end type io_test_type

contains


  subroutine setUp( this )

    implicit none

    class(io_test_type), intent(inout) :: this

  end subroutine setUp


  subroutine tearDown( this )

    implicit none

    class(io_test_type), intent(inout) :: this

  end subroutine tearDown

  ! Test filename generation for restart files
  @test
  subroutine test_restart_filename( this )

    use constants_mod,       only : str_max_filename
    use io_mod,              only : ts_fname

    implicit none

    class(io_test_type), intent(inout) :: this

    character(len=str_max_filename) :: rs_fname
    character(len=str_max_filename) :: fname,tname
    integer :: ts_start, ts_end

    ! now for some tests
    rs_fname="hswarez_100day"
    ts_start=4
    ts_end=6

    write(tname,'(A,A,A,A,I6.6)') "hswarez_100day","_", &
         "rho","_T",ts_start-1
    fname=trim(ts_fname(trim(rs_fname), "", "rho", (ts_start-1), ""))
    @assertEqual(tname,fname)

    write(tname,'(A,A,A,A,I6.6)') "hswarez_100day","_", &
         "rho","_T",ts_end
    fname=trim(ts_fname(trim(rs_fname), "", "rho", ts_end, ""))
    @assertEqual(tname,fname)

    write(tname,'(A,A,A,A,I6.6)') "hswarez_100day","_", &
         "rho","_T",7
    fname=trim(ts_fname(trim(rs_fname), "", "rho", 7, ""))

  end subroutine test_restart_filename

end module io_mod_test
