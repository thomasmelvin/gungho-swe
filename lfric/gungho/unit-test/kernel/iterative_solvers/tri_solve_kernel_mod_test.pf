!-----------------------------------------------------------------------------
! Copyright (c) 2017,  Met Office, on behalf of HMSO and Queen's Printer
! For further details please refer to the file LICENCE.original which you
! should have received as part of this distribution.
!-----------------------------------------------------------------------------

module tri_solve_kernel_mod_test

  use constants_mod, only: r_def, i_def
  use pFUnit_Mod

  implicit none

  private
  public :: tri_solve_kernel_test_type, test_all

  @TestCase
  type, extends(TestCase) :: tri_solve_kernel_test_type
    private
  contains
    procedure test_all
  end type tri_solve_kernel_test_type

contains

  !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  @test
  subroutine test_all( this )

    use tri_solve_kernel_mod, only: tri_solve_code

    implicit none

    class(tri_solve_kernel_test_type), intent(inout) :: this

    real(r_def) :: tol = 1.0e010_r_def

    integer(kind=i_def), parameter :: nz = 10
    integer(kind=i_def) :: map(1)
    real(kind=r_def) :: x(nz), y(nz), A0(nz), AP(nz), AM(nz)
    real(kind=r_def) :: answer(nz)
    real(kind=r_def) :: data_matrix(nz,6)
    map(1) = 1_i_def

    x      = real((/ 1, 4, 6, 2, -4, 2, 5, 8, -3, 2 /),r_def)
    answer = real((/ 0.595740342096225, &
                     1.536623742649890, &
                     1.921640812369115, &
                     0.678807366246152, &
                    -0.699910115193080, &
                     0.805771536505973, &
                     1.903359140732273, &
                     2.277107208194344, &
                    -0.248802850816906, &
                     0.456459501107042 /),r_def)
    A0     =  4.0_r_def
    AP     = -0.9_r_def
    AM     = -0.7_r_def

    call tri_solve_code(nz, y, x, A0, AP, AM, 1, nz, map)

    @assertEqual( answer, y, tol )

  end subroutine test_all

end module tri_solve_kernel_mod_test

